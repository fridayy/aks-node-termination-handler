%%%-------------------------------------------------------------------
%%% @author bnjm
%%% @copyright (C) 2022, <COMPANY>
%%% @doc
%%% Mock handler for Azure Metadata Instance Service
%%% @end
%%% Created : 25. Sep 2022 12:28 AM
%%%-------------------------------------------------------------------
-module(happy_instance_h).
-author("bnjm").

%% API
-export([init/2]).

init(Req, State) ->
  #{'api-version' := <<"2021-02-01">>} = cowboy_req:match_qs(['api-version'], Req),
  <<"true">> = cowboy_req:header(<<"metadata">>, Req),
  Response = <<"{\"compute\":{\"azEnvironment\":\"AzurePublicCloud\",\"customData\":\"\",\"evictionPolicy\":\"Delete\",\"isHostCompatibilityLayerVm\":\"false\",\"licenseType\":\"\",\"location\":\"westeurope\",\"name\":\"aks-spottest-41185300-vmss_2\",\"offer\":\"\",\"osProfile\":{\"adminUsername\":\"azureuser\",\"computerName\":\"aks-spottest-41185300-vmss000002\",\"disablePasswordAuthentication\":\"true\"},\"osType\":\"Linux\",\"placementGroupId\":\"d14510f5-7367-4b05-97d5-88be7c121846\",\"plan\":{\"name\":\"\",\"product\":\"\",\"publisher\":\"\"},\"platformFaultDomain\":\"0\",\"platformUpdateDomain\":\"0\",\"priority\":\"Spot\",\"provider\":\"Microsoft.Compute\",\"publicKeys\":[{\"keyData\":\"ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQDNrrv2zbYyuiq66gz8qn8A+Ezhq0XYa9l/BGL3F6DAxTZwGUJl1uFOD1jEJRg8v5q835yX2VLM+vCnzteF7uhgLBkKYxsaiNGt6P/6/W3t+gvFhLE3pdCHRYFJND4NrrsVg2lJYuwHoNuOH+90Y7wH36SivZPqfHR/T+PByCnqpBYxuE02qmbSvNlSl+iWz4H4a6aCyHURl7prq3NEIYC/McdEWd7bktUBUIOW/WWrCURq3esOmw2zsJgYxugj+wnx6f4/JwdJaq/kwd7rTntCcbIdO13Y0ksirP9bMSGE3c2qlWfr/E+6b6Y1t8DeTOBLptzzOKi0n1nUsG8vE0I0jP5Bggu91hq4EYQqvsxAn1A2bYEmobeSt7NANLb0DWeoJ2rwh3K3JGxxGuFo8xbw8H/0difW01BpTPjea6AcfPRTwWckiDuWMTf8zj700eYSrIQLFCgn2dDgFh8dht6d4Q22DZ3eyN63aG8cwthG7aFHcytViHNAAZOYgj3DY+JlRm83UU5GOWkuS2Ezw/89fAeQImOn2TlaIAx+t6WmFEKLLTm1yj6+//rsmHO9Ls0SBuTOLDUwK6zWCzBe2FDvTWvw+No0VOKw71efD5v7PcEU62JCUznpA6QEoM4q5F4NNbvWP4tl+xz+qA6tP8Dpe//SVhQ+ReS5OxCAfpfnqQ==\n\",\"path\":\"/home/azureuser/.ssh/authorized_keys\"}],\"publisher\":\"\",\"resourceGroupName\":\"MC_some-group_westeurope\",\"resourceId\":\"/subscriptions/e347b0b8-5569-4331-a149-54fc238e9e70/resourceGroups/MC_some-group_westeurope/providers/Microsoft.Compute/virtualMachineScaleSets/aks-spottest-41185300-vmss/virtualMachines/2\",\"securityProfile\":{\"secureBootEnabled\":\"false\",\"virtualTpmEnabled\":\"false\"},\"sku\":\"\",\"storageProfile\":{\"dataDisks\":[],\"imageReference\":{\"id\":\"/subscriptions/109a5e88-712a-48ae-9078-9ca8b3c81345/resourceGroups/AKS-Ubuntu/providers/Microsoft.Compute/galleries/AKSUbuntu/images/1804gen2containerd/versions/2022.08.23\",\"offer\":\"\",\"publisher\":\"\",\"sku\":\"\",\"version\":\"\"},\"osDisk\":{\"caching\":\"ReadOnly\",\"createOption\":\"FromImage\",\"diffDiskSettings\":{\"option\":\"Local\"},\"diskSizeGB\":\"128\",\"encryptionSettings\":{\"enabled\":\"false\"},\"image\":{\"uri\":\"\"},\"managedDisk\":{\"id\":\"/subscriptions/e347b0b8-5569-4331-a149-54fc238e9e70/resourceGroups/MC_some-group_westeurope/providers/Microsoft.Compute/disks/aks-spottest-4118530aks-spottest-41185300OS__1_db5b9ab3e17e465db24905f0f5fc6cb1\",\"storageAccountType\":\"Standard_LRS\"},\"name\":\"aks-spottest-4118530aks-spottest-41185300OS__1_db5b9ab3e17e465db24905f0f5fc6cb1\",\"osType\":\"Linux\",\"vhd\":{\"uri\":\"\"},\"writeAcceleratorEnabled\":\"false\"},\"resourceDisk\":{\"size\":\"65536\"}},\"subscriptionId\":\"e347b0b8-5569-4331-a149-54fc238e9e70\",\"tags\":\"aks-managed-createOperationID:3c70956d-649a-43e3-a576-86c51eeb8d11;aks-managed-creationSource:vmssclient-aks-spottest-41185300-vmss;aks-managed-kubeletIdentityClientID:e9f872fc-bf7b-4961-b543-761e8fd3c0b1;aks-managed-orchestrator:Kubernetes:1.22.6;aks-managed-poolName:spottest;aks-managed-resourceNameSuffix:31983405\",\"tagsList\":[{\"name\":\"aks-managed-createOperationID\",\"value\":\"3c70956d-649a-43e3-a576-86c51eeb8d11\"},{\"name\":\"aks-managed-creationSource\",\"value\":\"vmssclient-aks-spottest-41185300-vmss\"},{\"name\":\"aks-managed-kubeletIdentityClientID\",\"value\":\"e9f872fc-bf7b-4961-b543-761e8fd3c0b1\"},{\"name\":\"aks-managed-orchestrator\",\"value\":\"Kubernetes:1.22.6\"},{\"name\":\"aks-managed-poolName\",\"value\":\"spottest\"},{\"name\":\"aks-managed-resourceNameSuffix\",\"value\":\"31983405\"}],\"userData\":\"\",\"version\":\"\",\"vmId\":\"dd2be970-58af-4f72-9be1-60fe247f16e0\",\"vmScaleSetName\":\"aks-spottest-41185300-vmss\",\"vmSize\":\"Standard_D8s_v3\",\"zone\":\"\"},\"network\":{\"interface\":[{\"ipv4\":{\"ipAddress\":[{\"privateIpAddress\":\"10.224.0.14\",\"publicIpAddress\":\"\"}],\"subnet\":[{\"address\":\"10.224.0.0\",\"prefix\":\"16\"}]},\"ipv6\":{\"ipAddress\":[]},\"macAddress\":\"6045BD8996EB\"}]}}">>,
  {ok, cowboy_req:reply(200, #{<<"Metadata">> => <<"true">>}, Response, Req), State}.
